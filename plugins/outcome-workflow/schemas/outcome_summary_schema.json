{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Outcome Summary Schema",
  "description": "Summary index of all outcomes for quick lookups and reporting without scanning individual outcome_track files. Note: The 'state' field uses logical state names (queued, ready, in-progress, blocked, completed) while physical directories use numbered prefixes (0-queued, 1-ready, 2-in-progress, 3-blocked, 4-completed) for sorting.",
  "schemaVersion": "1.0.0",
  "type": "object",
  "required": [
    "summary",
    "outcomes",
    "indexByCapability",
    "indexByState"
  ],
  "properties": {
    "summary": {
      "type": "object",
      "description": "Aggregated statistics across all outcomes",
      "required": [
        "totalOutcomes",
        "totalTasks",
        "totalEstimatedTokens",
        "totalConsumedTokens",
        "lastUpdated"
      ],
      "properties": {
        "totalOutcomes": {
          "type": "integer",
          "description": "Total number of outcomes across all states",
          "minimum": 0
        },
        "outcomesByState": {
          "type": "object",
          "description": "Count of outcomes in each state",
          "properties": {
            "queued": {
              "type": "integer",
              "minimum": 0
            },
            "ready": {
              "type": "integer",
              "minimum": 0
            },
            "in-progress": {
              "type": "integer",
              "minimum": 0
            },
            "blocked": {
              "type": "integer",
              "minimum": 0
            },
            "completed": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "totalTasks": {
          "type": "integer",
          "description": "Total number of tasks across all outcomes",
          "minimum": 0
        },
        "tasksByState": {
          "type": "object",
          "description": "Count of tasks in each state",
          "properties": {
            "ready": {
              "type": "integer",
              "minimum": 0
            },
            "current": {
              "type": "integer",
              "minimum": 0
            },
            "success": {
              "type": "integer",
              "minimum": 0
            },
            "fail": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "totalEstimatedTokens": {
          "type": "integer",
          "description": "Sum of estimated tokens across all outcomes",
          "minimum": 0
        },
        "totalConsumedTokens": {
          "type": "integer",
          "description": "Sum of actual tokens consumed across all executions",
          "minimum": 0
        },
        "overallCompletionRate": {
          "type": "number",
          "description": "Percentage of tasks completed successfully (0-100)",
          "minimum": 0,
          "maximum": 100
        },
        "lastUpdated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 datetime when this summary was last updated"
        }
      }
    },
    "outcomes": {
      "type": "array",
      "description": "List of all outcomes with summary information",
      "items": {
        "type": "object",
        "required": [
          "id",
          "name",
          "directoryLabel",
          "capabilities",
          "state",
          "trackingFile",
          "progress",
          "createdAt",
          "updatedAt"
        ],
        "properties": {
          "id": {
            "type": "integer",
            "description": "Outcome numeric identifier",
            "minimum": 1
          },
          "name": {
            "type": "string",
            "description": "Human-readable outcome name"
          },
          "directoryLabel": {
            "type": "string",
            "description": "Directory name (e.g., 001-authentication-provider)"
          },
          "type": {
            "type": "string",
            "description": "Outcome type: atomic (single outcome) or parent (container with children)",
            "enum": ["atomic", "parent"]
          },
          "children": {
            "type": "array",
            "description": "For parent outcomes only: array of child directoryLabels (e.g., ['005.1-ontology-testing', '005.2-ontology-sync']). Omit for atomic outcomes.",
            "items": {
              "type": "string",
              "description": "Child outcome directoryLabel"
            }
          },
          "capabilities": {
            "type": "array",
            "description": "Capability tracking files this outcome contributes to",
            "items": {
              "type": "string",
              "description": "Path to capability_track.json file relative to workspace root",
              "pattern": "^capabilities/[a-z0-9]+(-[a-z0-9]+)*/capability_track\\.json$"
            },
            "minItems": 1
          },
          "state": {
            "type": "string",
            "description": "Current state of the outcome",
            "enum": [
              "queued",
              "ready",
              "in-progress",
              "blocked",
              "completed"
            ]
          },
          "trackingFile": {
            "type": "string",
            "description": "Relative path to the outcome_track.json file from workspace root (e.g., 'outcomes/in-progress/001-authentication-provider/outcome_track.json')"
          },
          "progress": {
            "type": "object",
            "description": "Progress metrics for this outcome",
            "required": [
              "totalTasks",
              "completedTasks",
              "failedTasks",
              "currentTask",
              "completionPercentage",
              "estimatedTokens",
              "consumedTokens"
            ],
            "properties": {
              "totalTasks": {
                "type": "integer",
                "description": "Total number of tasks in this outcome",
                "minimum": 0
              },
              "completedTasks": {
                "type": "integer",
                "description": "Number of tasks with state 'success'",
                "minimum": 0
              },
              "failedTasks": {
                "type": "integer",
                "description": "Number of tasks with state 'fail'",
                "minimum": 0
              },
              "currentTask": {
                "type": [
                  "string",
                  "null"
                ],
                "description": "fileName of the task currently in 'current' state, or null if none"
              },
              "completionPercentage": {
                "type": "number",
                "description": "Percentage of tasks completed (0-100)",
                "minimum": 0,
                "maximum": 100
              },
              "estimatedTokens": {
                "type": "integer",
                "description": "Total estimated tokens for this outcome",
                "minimum": 0
              },
              "consumedTokens": {
                "type": "integer",
                "description": "Actual tokens consumed so far",
                "minimum": 0
              }
            }
          },
          "latestActivity": {
            "type": [
              "object",
              "null"
            ],
            "description": "Information about the most recent activity",
            "properties": {
              "lastExecutionId": {
                "type": "string",
                "description": "ID of the most recent execution"
              },
              "lastExecutedTask": {
                "type": "string",
                "description": "fileName of the last task executed"
              },
              "lastExecutionState": {
                "type": "string",
                "description": "Result of the last execution",
                "enum": [
                  "success",
                  "fail"
                ]
              },
              "lastExecutionTime": {
                "type": "string",
                "format": "date-time",
                "description": "When the last execution completed"
              }
            }
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "When the outcome was created"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "When the outcome was last updated"
          },
          "completedAt": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time",
            "description": "When the outcome was completed, or null if not completed"
          }
        }
      }
    },
    "indexByCapability": {
      "type": "object",
      "description": "Index for quickly finding outcomes by capability. Keys are capability filenames, values are arrays of outcome IDs.",
      "additionalProperties": {
        "type": "array",
        "items": {
          "type": "integer"
        }
      }
    },
    "indexByState": {
      "type": "object",
      "description": "Index for quickly finding outcomes by state. Keys are state names, values are arrays of outcome IDs.",
      "properties": {
        "queued": {
          "type": "array",
          "description": "Outcome IDs in queued state",
          "items": {
            "type": "integer"
          }
        },
        "ready": {
          "type": "array",
          "description": "Outcome IDs in ready state (dependencies satisfied)",
          "items": {
            "type": "integer"
          }
        },
        "in-progress": {
          "type": "array",
          "description": "Outcome IDs in in-progress state",
          "items": {
            "type": "integer"
          }
        },
        "blocked": {
          "type": "array",
          "description": "Outcome IDs in blocked state",
          "items": {
            "type": "integer"
          }
        },
        "completed": {
          "type": "array",
          "description": "Outcome IDs in completed state",
          "items": {
            "type": "integer"
          }
        }
      }
    }
  },
  "examples": [
    {
      "summary": {
        "totalOutcomes": 3,
        "outcomesByState": {
          "queued": 1,
          "ready": 0,
          "in-progress": 1,
          "blocked": 0,
          "completed": 1
        },
        "totalTasks": 12,
        "tasksByState": {
          "ready": 4,
          "current": 1,
          "success": 6,
          "fail": 1
        },
        "totalEstimatedTokens": 42000,
        "totalConsumedTokens": 18500,
        "overallCompletionRate": 50.0,
        "lastUpdated": "2025-11-18T15:00:00Z"
      },
      "outcomes": [
        {
          "id": 1,
          "name": "authentication-provider",
          "directoryLabel": "001-authentication-provider",
          "capabilities": [
            "capabilities/authentication-system/capability_track.json",
            "capabilities/security-framework/capability_track.json"
          ],
          "state": "in-progress",
          "trackingFile": "outcomes/in-progress/001-authentication-provider/outcome_track.json",
          "progress": {
            "totalTasks": 4,
            "completedTasks": 2,
            "failedTasks": 0,
            "currentTask": "02-*-write-unit-tests.md",
            "completionPercentage": 50.0,
            "estimatedTokens": 14000,
            "consumedTokens": 7800
          },
          "latestActivity": {
            "lastExecutionId": "exec-002-i9j0k1l2",
            "lastExecutedTask": "01-B-create-user-model.md",
            "lastExecutionState": "success",
            "lastExecutionTime": "2025-11-18T14:30:00Z"
          },
          "createdAt": "2025-11-18T10:00:00Z",
          "updatedAt": "2025-11-18T14:30:00Z",
          "completedAt": null
        },
        {
          "id": 2,
          "name": "api-rate-limiting",
          "directoryLabel": "002-api-rate-limiting",
          "capabilities": [
            "capabilities/api-management/capability_track.json",
            "capabilities/security-framework/capability_track.json"
          ],
          "state": "queued",
          "trackingFile": "outcomes/queued/002-api-rate-limiting/outcome_track.json",
          "progress": {
            "totalTasks": 5,
            "completedTasks": 0,
            "failedTasks": 0,
            "currentTask": null,
            "completionPercentage": 0.0,
            "estimatedTokens": 18000,
            "consumedTokens": 0
          },
          "latestActivity": null,
          "createdAt": "2025-11-18T09:00:00Z",
          "updatedAt": "2025-11-18T09:00:00Z",
          "completedAt": null
        },
        {
          "id": 3,
          "name": "user-profile-service",
          "directoryLabel": "003-user-profile-service",
          "capabilities": [
            "capabilities/user-management/capability_track.json"
          ],
          "state": "completed",
          "trackingFile": "outcomes/completed/003-user-profile-service/outcome_track.json",
          "progress": {
            "totalTasks": 3,
            "completedTasks": 3,
            "failedTasks": 0,
            "currentTask": null,
            "completionPercentage": 100.0,
            "estimatedTokens": 10000,
            "consumedTokens": 10700
          },
          "latestActivity": {
            "lastExecutionId": "exec-015-z9y8x7w6",
            "lastExecutedTask": "03-A-deploy-to-staging.md",
            "lastExecutionState": "success",
            "lastExecutionTime": "2025-11-17T18:00:00Z"
          },
          "createdAt": "2025-11-15T10:00:00Z",
          "updatedAt": "2025-11-17T18:00:00Z",
          "completedAt": "2025-11-17T18:00:00Z"
        }
      ],
      "indexByCapability": {
        "capabilities/authentication-system/capability_track.json": [1],
        "capabilities/security-framework/capability_track.json": [1, 2],
        "capabilities/api-management/capability_track.json": [2],
        "capabilities/user-management/capability_track.json": [3]
      },
      "indexByState": {
        "queued": [2],
        "ready": [],
        "in-progress": [1],
        "blocked": [],
        "completed": [3]
      }
    }
  ]
}
